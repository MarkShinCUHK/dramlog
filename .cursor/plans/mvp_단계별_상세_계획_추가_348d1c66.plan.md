---
name: MVP 단계별 상세 계획 추가
overview: .cursorrules와 web-dev-guidelines.md에 MVP 4, 5, 6 단계의 구체적인 구현 계획을 추가합니다. 각 단계별로 파일 구조, 구현 세부사항, 쿼리 함수, 컴포넌트 등을 명시합니다.
todos:
  - id: update_cursorrules
    content: .cursorrules 파일에 MVP 4, 5, 6 단계의 상세 계획 추가 (파일 구조, 구현 세부사항 포함)
    status: pending
  - id: update_guidelines
    content: web-dev-guidelines.md 파일에 MVP 4, 5, 6 단계의 상세 계획 추가 (데이터베이스 스키마, 쿼리 함수, 컴포넌트 등 포함)
    status: pending
---

# MVP 단계별 상세 개발 계획 추가

## 목표

`.cursorrules`와 `web-dev-guidelines.md`에 MVP 4, 5, 6 단계의 구체적인 구현 계획을 추가하여 개발 가이드라인을 보강합니다.

## 변경 파일

1. `.cursorrules` - MVP 4, 5, 6 단계 상세 계획 추가
2. `web-dev-guidelines.md` - MVP 4, 5, 6 단계 상세 계획 추가

## MVP 4단계: 인증 시스템 (Supabase Auth 기반)

### 1. Supabase Auth 설정

- Supabase 대시보드에서 Authentication 활성화
- Email/Password 프로바이더 활성화
- 환경 변수 추가: `PUBLIC_SUPABASE_URL`, `PUBLIC_SUPABASE_ANON_KEY` (이미 설정됨)

### 2. 데이터베이스 스키마 변경

- `posts` 테이블에 `user_id UUID` 컬럼 추가 (auth.users 참조)
- `author_name` 컬럼은 유지 (하위 호환성)
- 외래키 제약조건 추가 (선택사항)

### 3. 파일 구조

```
src/
├── routes/
│   ├── login/
│   │   ├── +page.svelte (로그인 폼)
│   │   └── +page.server.ts (로그인 액션)
│   ├── signup/
│   │   ├── +page.svelte (회원가입 폼)
│   │   └── +page.server.ts (회원가입 액션)
│   └── logout/
│       └── +page.server.ts (로그아웃 액션)
├── lib/
│   ├── server/
│   │   └── supabase/
│   │       ├── auth.ts (인증 헬퍼 함수)
│   │       └── queries/
│   │           └── users.ts (사용자 쿼리 함수)
│   └── components/
│       └── AuthGuard.svelte (인증 보호 컴포넌트)
```

### 4. 구현 세부사항

- **인증 헬퍼 함수** (`src/lib/server/supabase/auth.ts`):
  - `getSession(cookies)`: 현재 세션 조회
  - `requireAuth(cookies)`: 인증 필수 (미인증 시 리다이렉트)
  - `getUser(cookies)`: 현재 사용자 정보 조회

- **로그인 페이지** (`/login`):
  - 이메일/비밀번호 입력 폼
  - 서버 액션: `supabase.auth.signInWithPassword()`
  - 성공 시 세션 쿠키 설정
  - 실패 시 에러 메시지 표시

- **회원가입 페이지** (`/signup`):
  - 이메일/비밀번호/사용자명 입력 폼
  - 서버 액션: `supabase.auth.signUp()`
  - 성공 시 자동 로그인 및 리다이렉트

- **로그아웃** (`/logout`):
  - 서버 액션: `supabase.auth.signOut()`
  - 세션 쿠키 삭제
  - 홈으로 리다이렉트

- **Header 컴포넌트 업데이트**:
  - 로그인 상태에 따라 "로그인/회원가입" 또는 "로그아웃" 버튼 표시
  - 사용자명 표시 (선택사항)

### 5. 권한 관리 적용

- **글 작성** (`/write`):
  - `requireAuth()`로 인증 확인
  - 미인증 시 `/login`으로 리다이렉트
  - `createPost()`에 `user_id` 전달

- **글 수정/삭제** (`/posts/[id]/edit`, `/posts/[id]`):
  - 게시글의 `user_id`와 현재 사용자 ID 비교
  - 본인 글만 수정/삭제 가능
  - 권한 없음 시 403 에러 또는 리다이렉트

### 6. 쿼리 함수 업데이트

- `src/lib/server/supabase/queries/posts.ts`:
  - `createPost()`: `user_id` 파라미터 추가
  - `updatePost()`: `user_id` 확인 로직 추가
  - `deletePost()`: `user_id` 확인 로직 추가
  - `getPostById()`: `user_id` 포함하여 반환

## MVP 5단계: 핵심 기능 강화

### 1. 검색 기능

#### 파일 구조

```
src/
├── routes/
│   └── search/
│       ├── +page.svelte (검색 결과 페이지)
│       └── +page.server.ts (검색 로직)
├── lib/
│   ├── server/
│   │   └── supabase/
│   │       └── queries/
│   │           └── posts.ts (searchPosts 함수 추가)
│   └── components/
│       └── SearchBar.svelte (검색바 컴포넌트)
```

#### 구현 세부사항

- **검색바 컴포넌트** (`SearchBar.svelte`):
  - Header에 통합 또는 독립 컴포넌트
  - 입력 시 `/search?q=검색어`로 이동

- **검색 쿼리 함수** (`searchPosts(query: string)`):
  - Supabase `ilike` 또는 `textSearch` 사용
  - 제목과 내용 모두 검색
  - 결과를 `Post[]` 타입으로 반환

- **검색 결과 페이지** (`/search`):
  - 쿼리 파라미터 `q` 읽기
  - 검색 결과 목록 표시
  - 결과 없음 메시지

- **DB 최적화**:
  - `posts` 테이블에 `title`, `content` 컬럼에 GIN 인덱스 추가 (Full-text search)

### 2. 댓글 시스템

#### 파일 구조

```
src/
├── routes/
│   └── posts/
│       └── [id]/
│           └── +page.svelte (댓글 섹션 추가)
├── lib/
│   ├── server/
│   │   └── supabase/
│   │       ├── queries/
│   │       │   └── comments.ts (댓글 CRUD 함수)
│   │       └── types.ts (Comment 타입 추가)
│   └── components/
│       ├── CommentList.svelte (댓글 목록)
│       ├── CommentForm.svelte (댓글 작성 폼)
│       └── CommentItem.svelte (댓글 아이템)
```

#### 데이터베이스 스키마

```sql
CREATE TABLE comments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_comments_post_id ON comments(post_id);
CREATE INDEX idx_comments_created_at ON comments(created_at DESC);
```

#### 구현 세부사항

- **댓글 쿼리 함수** (`src/lib/server/supabase/queries/comments.ts`):
  - `listComments(postId: string)`: 게시글의 댓글 목록 조회
  - `createComment(postId: string, content: string, userId: string)`: 댓글 작성
  - `updateComment(commentId: string, content: string, userId: string)`: 댓글 수정
  - `deleteComment(commentId: string, userId: string)`: 댓글 삭제

- **댓글 컴포넌트**:
  - `CommentList.svelte`: 댓글 목록 표시 (최신순)
  - `CommentForm.svelte`: 댓글 작성 폼 (인증 필요)
  - `CommentItem.svelte`: 개별 댓글 표시 (수정/삭제 버튼 포함)

- **게시글 상세 페이지 업데이트**:
  - 댓글 섹션 추가
  - 댓글 작성/수정/삭제 기능

### 3. 좋아요 기능

#### 파일 구조

```
src/
├── lib/
│   ├── server/
│   │   └── supabase/
│   │       ├── queries/
│   │       │   └── likes.ts (좋아요 함수)
│   │       └── types.ts (Like 타입 추가)
│   └── components/
│       └── LikeButton.svelte (좋아요 버튼)
```

#### 데이터베이스 스키마

```sql
CREATE TABLE likes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID NOT NULL REFERENCES posts(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(post_id, user_id) -- 중복 좋아요 방지
);

CREATE INDEX idx_likes_post_id ON likes(post_id);
CREATE INDEX idx_likes_user_id ON likes(user_id);
```

#### 구현 세부사항

- **좋아요 쿼리 함수** (`src/lib/server/supabase/queries/likes.ts`):
  - `getLikeCount(postId: string)`: 좋아요 개수 조회
  - `isLiked(postId: string, userId: string)`: 사용자가 좋아요 했는지 확인
  - `toggleLike(postId: string, userId: string)`: 좋아요 토글 (추가/제거)

- **LikeButton 컴포넌트**:
  - 하트 아이콘 (채워짐/비어있음)
  - 좋아요 개수 표시
  - 클릭 시 토글 (인증 필요)

- **게시글 상세 페이지 업데이트**:
  - LikeButton 컴포넌트 추가
  - PostCard 컴포넌트에 좋아요 개수 표시 (선택사항)

## MVP 6단계: UI/UX 개선

### 1. 반응형 디자인

#### 구현 세부사항

- **모바일 최적화** (< 640px):
  - Header: 햄버거 메뉴 또는 간소화된 네비게이션
  - 게시글 목록: 단일 컬럼, 카드 레이아웃
  - 버튼: 터치 친화적 크기 (최소 44x44px)

- **태블릿 레이아웃** (640px - 1024px):
  - 게시글 목록: 2컬럼 그리드
  - 사이드바 또는 추가 정보 표시

- **데스크톱 레이아웃** (> 1024px):
  - 최대 너비 제한 (예: max-w-7xl)
  - 최적화된 여백 및 간격

- **Tailwind 반응형 클래스 활용**:
  - `sm:`, `md:`, `lg:`, `xl:` 브레이크포인트 사용
  - Mobile First 접근

### 2. 사용자 경험 개선

#### 로딩 상태

- **스켈레톤 UI 컴포넌트** (`src/lib/components/Skeleton.svelte`):
  - 게시글 목록 로딩 시 스켈레톤 표시
  - Tailwind 애니메이션 활용

- **SvelteKit `{#await}` 블록 활용**:
  - 비동기 데이터 로딩 상태 표시
  - 에러 상태 처리

#### 에러 처리

- **에러 페이지 개선** (`src/routes/+error.svelte`):
  - 친화적인 에러 메시지
  - 홈으로 돌아가기 버튼
  - 에러 코드별 메시지 (404, 500 등)

- **폼 에러 처리**:
  - 실시간 유효성 검사
  - 필드별 에러 메시지 표시
  - 서버 에러 메시지 표시

#### 피드백

- **토스트 알림 시스템** (선택사항):
  - 성공/에러 메시지 표시
  - 자동 사라짐 (3-5초)
  - 컴포넌트: `Toast.svelte`, `ToastContainer.svelte`

- **성공 피드백**:
  - 글 작성/수정/삭제 성공 시 메시지
  - 댓글 작성 성공 시 메시지

#### 페이지네이션

- **게시글 목록 페이지네이션**:
  - 페이지당 게시글 수 제한 (예: 10개)
  - 이전/다음 페이지 버튼
  - 페이지 번호 표시 (선택사항)

- **쿼리 함수 업데이트**:
  - `listPosts(limit?: number, offset?: number)`: 페이지네이션 지원
  - `getPostCount()`: 전체 게시글 개수 조회

- **컴포넌트**: `Pagination.svelte`

### 3. 성능 최적화

#### 이미지 최적화 (향후 이미지 업로드 기능 추가 시)

- Lazy loading
- WebP 형식 지원
- 썸네일 생성

#### 코드 스플리팅

- SvelteKit의 자동 코드 스플리팅 활용
- 라우트별 코드 분리

#### DB 최적화

- 인덱스 추가 (이미 일부 구현됨)
- 쿼리 최적화
- 연결 풀링 (Supabase에서 자동 관리)

## 구현 우선순위

1. **MVP 4: 인증 시스템** (필수)

   - 권한 관리의 기반
   - 게시글 작성자 연결

2. **MVP 5: 핵심 기능 강화** (중요)

   - 검색 기능 (사용자 편의성)
   - 댓글 시스템 (커뮤니티 핵심)
   - 좋아요 기능 (상호작용)

3. **MVP 6: UI/UX 개선** (개선)

   - 반응형 디자인 (접근성)
   - 로딩/에러 처리 (사용자 경험)
   - 페이지네이션 (성능)

## 참고사항

- 각 단계는 독립적으로 구현 가능하지만, MVP 4 (인증)는 MVP 5의 일부 기능(댓글, 좋아요)에 필요
- MVP 6의 일부 기능(로딩 상태, 에러 처리)은 각 단계에서 점진적으로 적용 가능
- 모든 구현은 Tailwind CSS만 사용, 컴포넌트 분리, 쿼리 계층 활용 원칙 준수